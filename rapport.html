<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Rapport de Conseil/Assises</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .form-section, .report-section, .saved-reports-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="datetime-local"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="datetime-local"]:focus,
        input[type="date"]:focus,
        select:focus,
        textarea:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .agenda-item {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .agenda-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .agenda-item-title {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .remove-item {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .remove-item:hover {
            background-color: #c0392b;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: var(--light-color);
            color: var(--dark-color);
            margin-right: 10px;
        }
        
        .btn-secondary:hover {
            background-color: #d5dbdb;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .button-group {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }
        
        .report {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 20px;
        }
        
        .report-title {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .report-meta {
            color: #666;
            font-style: italic;
        }
        
        .report-section {
            margin-bottom: 25px;
        }
        
        .agenda-point {
            margin-bottom: 15px;
        }
        
        .agenda-point-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        
        .agenda-point-content {
            margin-left: 20px;
            color: #555;
        }
        
        .signature-section {
            margin-top: 40px;
            text-align: right;
        }
        
        .signature-line {
            width: 300px;
            border-bottom: 1px solid #333;
            margin: 40px auto 5px;
            display: inline-block;
        }
        
        .signature-label {
            font-style: italic;
            color: #666;
        }
        
        .hidden {
            display: none;
        }
        
        /* Styles pour la section des rapports sauvegard√©s */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .saved-reports-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .report-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .report-item:last-child {
            border-bottom: none;
        }
        
        .report-item:hover {
            background-color: #f9f9f9;
        }
        
        .report-item-info {
            flex: 1;
        }
        
        .report-item-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .report-item-meta {
            color: #666;
            font-size: 0.9rem;
        }
        
        .report-item-actions {
            display: flex;
            gap: 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        /* Styles pour les options de r√©daction */
        .writing-options {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .writing-options h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .writing-style-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .writing-style-option {
            flex: 1;
            min-width: 200px;
        }
        
        .writing-style-option label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .writing-style-option input {
            width: auto;
        }
        
        .discourse-flow {
            background-color: #e8f4fc;
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .transition-phrase {
            font-style: italic;
            color: var(--secondary-color);
            margin: 10px 0;
            font-weight: 500;
        }
        
        @media print {
            .form-section, .button-group, .saved-reports-section {
                display: none;
            }
            
            .report-section {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            
            body {
                background-color: white;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .form-section, .report-section, .saved-reports-section {
                padding: 15px;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .report-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .report-item-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-end;
            }
            
            .writing-style-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>G√©n√©rateur de Rapport de Conseil/Assises</h1>
            <p class="subtitle">Cr√©ez automatiquement des rapports professionnels pour vos r√©unions</p>
        </header>
        
        <section class="form-section">
            <h2>Informations de la r√©union</h2>
            
            <div class="form-group">
                <label for="meetingType">Type de r√©union</label>
                <select id="meetingType" class="form-control">
                    <option value="Conseil de Rentr√©e">Conseil de Rentr√©e</option>
                    <option value="Conseil d'enseignement">Conseil d'enseignement</option>
                    <option value="Journ√©e p√©dagogique">Journ√©e p√©dagogique</option>
                    <option value="Conseil de fin du premier trimestre">Conseil de fin du premier trimestre</option>
                     <option value="Conseil de fin du deuxi√®me trimestre">Conseil de fin du deuxi√®me trimestre</option>
                    <option value="Conseil de fin d'ann√©e scolaire">Conseil de fin d'ann√©e scolaire</option>
                    <option value="Assembl√©e g√©n√©rale">Assembl√©e g√©n√©rale</option
                </select>
            </div>
            
            <div class="form-group">
                <label for="meetingObject">Objet de la r√©union</label>
                <input type="text" id="meetingObject" placeholder="Ex: R√©union trimestrielle du conseil d'administration">
            </div>
            
            <div class="form-group">
                <label for="meetingDate">Date et heure de d√©but</label>
                <input type="datetime-local" id="meetingDate">
            </div>
            
            <div class="form-group">
                <label for="meetingEndDate">Date et heure de fin</label>
                <input type="datetime-local" id="meetingEndDate">
            </div>
            
            <div class="form-group">
                <label for="meetingLocation">Lieu de la r√©union</label>
                <input type="text" id="meetingLocation" placeholder="Ex: Salle de conf√©rence A, Si√®ge social">
            </div>
            
            <div class="form-group">
                <label for="secretaryName">Nom et pr√©noms du secr√©taire de s√©ance</label>
                <input type="text" id="secretaryName" placeholder="Ex: DUPONT Jean">
            </div>
            
            <div class="writing-options">
                <h3>Options de r√©daction</h3>
                <div class="writing-style-selector">
                    <div class="writing-style-option">
                        <label>
                            <input type="radio" name="writingStyle" value="formal" checked>
                            Style formel (administratif)
                        </label>
                    </div>
                    <div class="writing-style-option">
                        <label>
                            <input type="radio" name="writingStyle" value="educational">
                            Style p√©dagogique (enseignant)
                        </label>
                    </div>
                    <div class="writing-style-option">
                        <label>
                            <input type="radio" name="writingStyle" value="dynamic">
                            Discours anim√©
                        </label>
                    </div>
                </div>
            </div>
            
            <h2>Ordre du jour</h2>
            
            <div id="agendaItems">
                <!-- Les √©l√©ments de l'ordre du jour seront ajout√©s ici dynamiquement -->
            </div>
            
            <button id="addAgendaItem" class="btn btn-secondary">Ajouter un point √† l'ordre du jour</button>
            
            <div class="button-group">
                <button id="generateReport" class="btn btn-primary">G√©n√©rer le rapport</button>
                <button id="resetForm" class="btn btn-danger">R√©initialiser</button>
            </div>
        </section>
        
        <section id="reportSection" class="report-section hidden">
            <div class="button-group">
                <button id="saveReport" class="btn btn-success">Sauvegarder le rapport</button>
                <button id="printReport" class="btn btn-primary">Imprimer le rapport</button>
                <button id="editReport" class="btn btn-secondary">Modifier les informations</button>
            </div>
            
            <div class="report" id="generatedReport">
                <!-- Le rapport g√©n√©r√© sera ins√©r√© ici -->
            </div>
        </section>
        
        <section class="saved-reports-section">
            <h2>Rapports sauvegard√©s</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="filterDate">Filtrer par date</label>
                    <input type="date" id="filterDate">
                </div>
                
                <div class="filter-group">
                    <label for="filterType">Filtrer par type</label>
                    <select id="filterType">
                        <option value="">Tous les types</option>
                        <option value="Conseil">Conseil</option>
                        <option value="Assises">Assises</option>
                        <option value="Comit√©">Comit√©</option>
                        <option value="Assembl√©e">Assembl√©e</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterKeyword">Filtrer par mot-cl√©</label>
                    <input type="text" id="filterKeyword" placeholder="Rechercher...">
                </div>
            </div>
            
            <div id="savedReportsList" class="saved-reports-list">
                <!-- Les rapports sauvegard√©s seront affich√©s ici -->
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // √âl√©ments du DOM
            const addAgendaItemBtn = document.getElementById('addAgendaItem');
            const agendaItemsContainer = document.getElementById('agendaItems');
            const generateReportBtn = document.getElementById('generateReport');
            const resetFormBtn = document.getElementById('resetForm');
            const reportSection = document.getElementById('reportSection');
            const generatedReport = document.getElementById('generatedReport');
            const printReportBtn = document.getElementById('printReport');
            const editReportBtn = document.getElementById('editReport');
            const saveReportBtn = document.getElementById('saveReport');
            const savedReportsList = document.getElementById('savedReportsList');
            const filterDate = document.getElementById('filterDate');
            const filterType = document.getElementById('filterType');
            const filterKeyword = document.getElementById('filterKeyword');
            
            // Variables
            let agendaItemCount = 0;
            let savedReports = JSON.parse(localStorage.getItem('savedReports')) || [];
            let currentReportId = null;
            
            // Initialiser l'affichage des rapports sauvegard√©s
            displaySavedReports();
            
            // Ajouter un point √† l'ordre du jour
            addAgendaItemBtn.addEventListener('click', function() {
                agendaItemCount++;
                const agendaItem = document.createElement('div');
                agendaItem.className = 'agenda-item';
                agendaItem.innerHTML = `
                    <div class="agenda-item-header">
                        <span class="agenda-item-title">Point ${agendaItemCount}</span>
                        <button type="button" class="remove-item">Supprimer</button>
                    </div>
                    <div class="form-group">
                        <label for="agendaTitle${agendaItemCount}">Titre du point</label>
                        <input type="text" id="agendaTitle${agendaItemCount}" placeholder="Ex: Approbation du proc√®s-verbal pr√©c√©dent">
                    </div>
                    <div class="form-group">
                        <label for="agendaDetails${agendaItemCount}">Grandes lignes / D√©tails</label>
                        <textarea id="agendaDetails${agendaItemCount}" placeholder="D√©crivez les principaux points abord√©s, les discussions, les d√©cisions prises..."></textarea>
                    </div>
                `;
                
                agendaItemsContainer.appendChild(agendaItem);
                
                // Ajouter l'√©v√©nement de suppression
                const removeBtn = agendaItem.querySelector('.remove-item');
                removeBtn.addEventListener('click', function() {
                    agendaItemsContainer.removeChild(agendaItem);
                    updateAgendaItemNumbers();
                });
            });
            
            // Mettre √† jour les num√©ros des points de l'ordre du jour
            function updateAgendaItemNumbers() {
                const agendaItems = agendaItemsContainer.querySelectorAll('.agenda-item');
                agendaItemCount = agendaItems.length;
                
                agendaItems.forEach((item, index) => {
                    const titleSpan = item.querySelector('.agenda-item-title');
                    titleSpan.textContent = `Point ${index + 1}`;
                    
                    const titleInput = item.querySelector('input[type="text"]');
                    const detailsTextarea = item.querySelector('textarea');
                    
                    titleInput.id = `agendaTitle${index + 1}`;
                    detailsTextarea.id = `agendaDetails${index + 1}`;
                    
                    const titleLabel = item.querySelector('label[for^="agendaTitle"]');
                    const detailsLabel = item.querySelector('label[for^="agendaDetails"]');
                    
                    titleLabel.setAttribute('for', `agendaTitle${index + 1}`);
                    detailsLabel.setAttribute('for', `agendaDetails${index + 1}`);
                });
            }
            
            // G√©n√©rer le rapport
            generateReportBtn.addEventListener('click', function() {
                // R√©cup√©rer les valeurs du formulaire
                const meetingType = document.getElementById('meetingType').value;
                const meetingObject = document.getElementById('meetingObject').value;
                const meetingDate = document.getElementById('meetingDate').value;
                const meetingEndDate = document.getElementById('meetingEndDate').value;
                const meetingLocation = document.getElementById('meetingLocation').value;
                const secretaryName = document.getElementById('secretaryName').value;
                const writingStyle = document.querySelector('input[name="writingStyle"]:checked').value;
                
                // R√©cup√©rer les points de l'ordre du jour
                const agendaItems = [];
                const agendaElements = agendaItemsContainer.querySelectorAll('.agenda-item');
                
                agendaElements.forEach(item => {
                    const title = item.querySelector('input[type="text"]').value;
                    const details = item.querySelector('textarea').value;
                    
                    if (title.trim() !== '') {
                        agendaItems.push({ title, details });
                    }
                });
                
                // Valider les champs obligatoires
                if (!meetingObject || !meetingDate || !meetingLocation || !secretaryName || agendaItems.length === 0) {
                    alert('Veuillez remplir tous les champs obligatoires : Objet, Date de d√©but, Lieu, Secr√©taire de s√©ance et au moins un point √† l\'ordre du jour.');
                    return;
                }
                
                // Formater les dates
                const startDate = new Date(meetingDate);
                const endDate = new Date(meetingEndDate);
                
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                
                const formattedStartDate = startDate.toLocaleDateString('fr-FR', options);
                const formattedEndDate = endDate.toLocaleDateString('fr-FR', options);
                
                // G√©n√©rer le HTML du rapport selon le style choisi
                let reportHTML = generateReportContent(
                    meetingType, 
                    meetingObject, 
                    formattedStartDate, 
                    formattedEndDate, 
                    meetingLocation, 
                    secretaryName, 
                    agendaItems,
                    writingStyle
                );
                
                // Stocker les donn√©es du rapport actuel pour sauvegarde
                currentReportId = Date.now();
                const reportData = {
                    id: currentReportId,
                    meetingType,
                    meetingObject,
                    meetingDate,
                    meetingEndDate,
                    meetingLocation,
                    secretaryName,
                    agendaItems,
                    writingStyle,
                    generatedDate: new Date().toISOString()
                };
                
                // Stocker les donn√©es dans l'√©l√©ment g√©n√©r√©Report pour r√©cup√©ration ult√©rieure
                generatedReport.dataset.reportData = JSON.stringify(reportData);
                
                // Afficher le rapport
                generatedReport.innerHTML = reportHTML;
                reportSection.classList.remove('hidden');
                
                // Faire d√©filer vers le rapport
                reportSection.scrollIntoView({ behavior: 'smooth' });
            });
            
            // G√©n√©rer le contenu du rapport selon le style choisi
            function generateReportContent(meetingType, meetingObject, startDate, endDate, location, secretary, agendaItems, style) {
                let content = '';
                
                // En-t√™te du rapport
                content += `
                    <div class="report-header">
                        <h1 class="report-title">RAPPORT DE ${meetingType.toUpperCase()}</h1>
                        <p class="report-meta">${meetingObject}</p>
                    </div>
                `;
                
                // Section d'introduction selon le style
                content += '<div class="report-section">';
                content += '<h2>Introduction</h2>';
                
                if (style === 'formal') {
                    content += `
                        <p>Le pr√©sent rapport a pour objet de consigner les d√©lib√©rations et d√©cisions prises lors de la ${meetingType.toLowerCase()} qui s'est tenue le ${startDate} dans les locaux de ${location}.</p>
                        <p>Cette s√©ance, pr√©sid√©e par ${secretary} en qualit√© de secr√©taire de s√©ance, a r√©uni l'ensemble des membres concern√©s afin d'examiner les points inscrits √† l'ordre du jour.</p>
                        <p>La s√©ance s'est ouverte √† ${startDate.split('√†')[1]} et s'est cl√¥tur√©e √† ${endDate.split('√†')[1]}.</p>
                    `;
                } else if (style === 'educational') {
                    content += `
                        <p>Ce document pr√©sente le compte-rendu d√©taill√© de la ${meetingType.toLowerCase()} qui s'est d√©roul√©e le ${startDate} au sein de ${location}.</p>
                        <p>Sous la houlette de ${secretary}, qui en assurait le secr√©tariat, cette r√©union a permis d'aborder l'ensemble des th√©matiques pr√©vues √† l'ordre du jour.</p>
                        <p>La s√©ance a d√©but√© √† ${startDate.split('√†')[1]} pour s'achever √† ${endDate.split('√†')[1]}, permettant ainsi un examen approfondi de chaque point.</p>
                    `;
                } else {
                    content += `
                        <div class="discourse-flow">
                            <p>Nous nous sommes r√©unis ce ${startDate.split(' ')[0]} dans l'enceinte de ${location} pour une ${meetingType.toLowerCase()} des plus importantes, consacr√©e √† "${meetingObject}".</p>
                            <p>Anim√©e par ${secretary} en qualit√© de secr√©taire de s√©ance, cette rencontre a d√©but√© √† ${startDate.split('√†')[1]} dans une atmosph√®re √† la fois studieuse et constructive.</p>
                            <p>Au fil des √©changes qui se sont poursuivis jusqu'√† ${endDate.split('√†')[1]}, nous avons successivement abord√© les ${agendaItems.length} points essentiels qui structuraient notre ordre du jour.</p>
                        </div>
                    `;
                }
                
                content += '</div>';
                
                // Section ordre du jour
                content += '<div class="report-section">';
                content += '<h2>Ordre du jour</h2>';
                
                if (style === 'formal') {
                    content += `<p>L'ordre du jour comportait ${agendaItems.length} points principaux :</p>`;
                } else if (style === 'educational') {
                    content += `<p>L'ordre du jour, compos√© de ${agendaItems.length} points, a structur√© les √©changes de la mani√®re suivante :</p>`;
                } else {
                    content += `
                        <div class="discourse-flow">
                            <p>Notre parcours √† travers l'ordre du jour nous a conduits √† examiner successivement les points suivants :</p>
                        </div>
                    `;
                }
                
                // Ajouter les points de l'ordre du jour
                agendaItems.forEach((item, index) => {
                    content += `
                        <div class="agenda-point">
                            <div class="agenda-point-title">${index + 1}. ${item.title}</div>
                            <div class="agenda-point-content">${formatAgendaContent(item.details, style, index, agendaItems.length)}</div>
                        </div>
                    `;
                    
                    // Ajouter des transitions entre les points pour le style anim√©
                    if (style === 'dynamic' && index < agendaItems.length - 1) {
                        content += `<div class="transition-phrase">${generateTransition(index, agendaItems.length)}</div>`;
                    }
                });
                
                content += '</div>';
                
                // Section de synth√®se selon le style
                content += '<div class="report-section">';
                content += '<h2>Synth√®se et perspectives</h2>';
                
                if (style === 'formal') {
                    content += `
                        <p>La ${meetingType.toLowerCase()} s'est d√©roul√©e dans un climat constructif, permettant l'examen approfondi de l'ensemble des points √† l'ordre du jour.</p>
                        <p>Les d√©bats ont √©t√© riches et ont conduit √† des d√©cisions concert√©es qui seront mises en ≈ìuvre dans les d√©lais impartis.</p>
                        <p>Un prochain point d'√©tape sera programm√© afin d'√©valuer l'avancement des d√©cisions prises lors de la pr√©sente s√©ance.</p>
                    `;
                } else if (style === 'educational') {
                    content += `
                        <p>Cette ${meetingType.toLowerCase()} a √©t√© marqu√©e par la qualit√© des √©changes et la pertinence des r√©flexions men√©es collectivement.</p>
                        <p>Les d√©cisions arr√™t√©es √† l'issue des discussions t√©moignent d'une vision partag√©e et d'un engagement commun pour la r√©ussite des projets abord√©s.</p>
                        <p>Le suivi des actions d√©cid√©es fera l'objet d'une attention particuli√®re lors de la prochaine r√©union de travail.</p>
                    `;
                } else {
                    content += `
                        <div class="discourse-flow">
                            <p>Au terme de cette ${meetingType.toLowerCase()} qui a dur√© pr√®s de ${calculateDuration(startDate, endDate)}, nous pouvons affirmer avec satisfaction que tous les objectifs fix√©s ont √©t√© atteints.</p>
                            <p>Les √©changes fructueux et les d√©cisions prises collectivement t√©moignent de l'engagement de chacun pour faire avancer nos projets communs.</p>
                            <p>Cette r√©union aura √©t√© un moment fort de concertation et de r√©flexion strat√©gique, dont nous tirerons pleinement profit dans les semaines √† venir.</p>
                            <p>Rendez-vous est donc pris pour notre prochaine rencontre, o√π nous ferons le point sur l'avancement des d√©cisions prises aujourd'hui.</p>
                        </div>
                    `;
                }
                
                content += '</div>';
                
                // Section de signature
                content += `
                    <div class="signature-section">
                        <p>Fait √† ${location}, le ${startDate.split(' ').slice(0, 4).join(' ')}</p>
                        <div class="signature-line"></div>
                        <p class="signature-label">Le Secr√©taire de s√©ance</p>
                        <p><strong>${secretary}</strong></p>
                    </div>
                `;
                
                return content;
            }
            
            // Formater le contenu d'un point de l'ordre du jour selon le style
            function formatAgendaContent(details, style, index, totalItems) {
                if (!details.trim()) return '<em>Aucun d√©tail fourni</em>';
                
                const lines = details.split('\n').filter(line => line.trim());
                
                if (style === 'formal') {
                    return lines.map(line => {
                        if (line.trim().endsWith('.')) {
                            return `<p>${line.trim()}</p>`;
                        } else {
                            return `<p>${line.trim()}.</p>`;
                        }
                    }).join('');
                } else if (style === 'educational') {
                    return lines.map(line => {
                        const trimmedLine = line.trim();
                        if (trimmedLine.length < 50) {
                            return `<p><strong>${trimmedLine}</strong></p>`;
                        } else {
                            return `<p>${trimmedLine}</p>`;
                        }
                    }).join('');
                } else {
                    // Style anim√©
                    let formattedContent = '';
                    
                    if (index === 0) {
                        formattedContent += `<p>Pour commencer, nous avons abord√© la question de "${lines[0].split(':')[0] || lines[0].substring(0, 50)}..."</p>`;
                    } else if (index === totalItems - 1) {
                        formattedContent += `<p>Enfin, pour cl√¥turer notre ordre du jour, nous nous sommes pench√©s sur "${lines[0].split(':')[0] || lines[0].substring(0, 50)}..."</p>`;
                    } else {
                        formattedContent += `<p>Poursuivant nos travaux, nous avons ensuite examin√© "${lines[0].split(':')[0] || lines[0].substring(0, 50)}..."</p>`;
                    }
                    
                    formattedContent += lines.map(line => {
                        const trimmedLine = line.trim();
                        return `<p>${trimmedLine}</p>`;
                    }).join('');
                    
                    return formattedContent;
                }
            }
            
            // G√©n√©rer des transitions entre les points pour le style anim√©
            function generateTransition(currentIndex, totalItems) {
                const transitions = [
                    "Forts des conclusions de ce premier point, nous avons naturellement encha√Æn√© avec le sujet suivant.",
                    "Sur ces bases solides, nous avons poursuivi notre examen avec le point suivant.",
                    "Ces √©l√©ments √©tant act√©s, l'assembl√©e s'est tourn√©e vers le prochain point √† l'ordre du jour.",
                    "Apr√®s cet √©change nourri, la discussion s'est orient√©e vers le sujet suivant.",
                    "Une fois ce point clarifi√©, nous avons abord√© la question suivante avec une vision renouvel√©e.",
                    "Ces d√©cisions prises, nous avons poursuivi notre cheminement √† travers l'ordre du jour.",
                    "Sur cette dynamique positive, nous avons encha√Æn√© avec le point suivant.",
                    "Ces perspectives trac√©es, nous nous sommes attel√©s √† l'examen du sujet suivant."
                ];
                
                // Choisir une transition al√©atoire
                return transitions[Math.floor(Math.random() * transitions.length)];
            }
            
            // Calculer la dur√©e de la r√©union
            function calculateDuration(startDate, endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const diffMs = end - start;
                const diffHrs = Math.floor(diffMs / 3600000);
                const diffMins = Math.round((diffMs % 3600000) / 60000);
                
                if (diffHrs === 0) {
                    return `${diffMins} minutes`;
                } else if (diffMins === 0) {
                    return `${diffHrs} heure${diffHrs > 1 ? 's' : ''}`;
                } else {
                    return `${diffHrs} heure${diffHrs > 1 ? 's' : ''} et ${diffMins} minute${diffMins > 1 ? 's' : ''}`;
                }
            }
            
            // Sauvegarder le rapport
            saveReportBtn.addEventListener('click', function() {
                const reportData = generatedReport.dataset.reportData;
                
                if (!reportData) {
                    alert('Veuillez d\'abord g√©n√©rer un rapport avant de le sauvegarder.');
                    return;
                }
                
                const parsedData = JSON.parse(reportData);
                
                // V√©rifier si le rapport existe d√©j√†
                const existingIndex = savedReports.findIndex(report => report.id === parsedData.id);
                
                if (existingIndex !== -1) {
                    // Mettre √† jour le rapport existant
                    savedReports[existingIndex] = parsedData;
                } else {
                    // Ajouter le nouveau rapport
                    savedReports.push(parsedData);
                }
                
                // Sauvegarder dans le localStorage
                localStorage.setItem('savedReports', JSON.stringify(savedReports));
                
                // Mettre √† jour l'affichage
                displaySavedReports();
                
                alert('Rapport sauvegard√© avec succ√®s !');
            });
            
            // Afficher les rapports sauvegard√©s
            function displaySavedReports() {
                let filteredReports = [...savedReports];
                
                // Appliquer les filtres
                if (filterDate.value) {
                    const filterDateObj = new Date(filterDate.value);
                    filteredReports = filteredReports.filter(report => {
                        const reportDate = new Date(report.meetingDate);
                        return reportDate.toDateString() === filterDateObj.toDateString();
                    });
                }
                
                if (filterType.value) {
                    filteredReports = filteredReports.filter(report => report.meetingType === filterType.value);
                }
                
                if (filterKeyword.value) {
                    const keyword = filterKeyword.value.toLowerCase();
                    filteredReports = filteredReports.filter(report => 
                        report.meetingObject.toLowerCase().includes(keyword) ||
                        report.meetingLocation.toLowerCase().includes(keyword) ||
                        report.secretaryName.toLowerCase().includes(keyword) ||
                        report.agendaItems.some(item => 
                            item.title.toLowerCase().includes(keyword) || 
                            item.details.toLowerCase().includes(keyword)
                        )
                    );
                }
                
                // Trier par date (du plus r√©cent au plus ancien)
                filteredReports.sort((a, b) => new Date(b.meetingDate) - new Date(a.meetingDate));
                
                // Afficher les rapports
                if (filteredReports.length === 0) {
                    savedReportsList.innerHTML = `
                        <div class="empty-state">
                            <div>üìã</div>
                            <h3>Aucun rapport trouv√©</h3>
                            <p>Les rapports sauvegard√©s appara√Ætront ici.</p>
                        </div>
                    `;
                } else {
                    savedReportsList.innerHTML = filteredReports.map(report => {
                        const startDate = new Date(report.meetingDate);
                        const formattedDate = startDate.toLocaleDateString('fr-FR', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        
                        return `
                            <div class="report-item">
                                <div class="report-item-info">
                                    <div class="report-item-title">${report.meetingObject}</div>
                                    <div class="report-item-meta">
                                        ${report.meetingType} ‚Ä¢ ${formattedDate} ‚Ä¢ ${report.meetingLocation} ‚Ä¢ ${report.secretaryName}
                                    </div>
                                    <div class="report-item-meta">
                                        Style: ${getWritingStyleLabel(report.writingStyle)}
                                    </div>
                                </div>
                                <div class="report-item-actions">
                                    <button class="btn btn-secondary view-report" data-id="${report.id}">Voir</button>
                                    <button class="btn btn-primary load-report" data-id="${report.id}">Charger</button>
                                    <button class="btn btn-danger delete-report" data-id="${report.id}">Supprimer</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Ajouter les √©v√©nements aux boutons
                    document.querySelectorAll('.view-report').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const reportId = parseInt(this.dataset.id);
                            viewReport(reportId);
                        });
                    });
                    
                    document.querySelectorAll('.load-report').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const reportId = parseInt(this.dataset.id);
                            loadReport(reportId);
                        });
                    });
                    
                    document.querySelectorAll('.delete-report').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const reportId = parseInt(this.dataset.id);
                            deleteReport(reportId);
                        });
                    });
                }
            }
            
            // Obtenir le libell√© du style de r√©daction
            function getWritingStyleLabel(style) {
                switch(style) {
                    case 'formal': return 'Formel';
                    case 'educational': return 'P√©dagogique';
                    case 'dynamic': return 'Discours anim√©';
                    default: return 'Non sp√©cifi√©';
                }
            }
            
            // Visualiser un rapport sauvegard√©
            function viewReport(reportId) {
                const report = savedReports.find(r => r.id === reportId);
                if (!report) return;
                
                // Formater les dates
                const startDate = new Date(report.meetingDate);
                const endDate = new Date(report.meetingEndDate);
                
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                
                const formattedStartDate = startDate.toLocaleDateString('fr-FR', options);
                const formattedEndDate = endDate.toLocaleDateString('fr-FR', options);
                
                // G√©n√©rer le HTML du rapport
                const reportHTML = generateReportContent(
                    report.meetingType,
                    report.meetingObject,
                    formattedStartDate,
                    formattedEndDate,
                    report.meetingLocation,
                    report.secretaryName,
                    report.agendaItems,
                    report.writingStyle
                );
                
                // Afficher le rapport dans une nouvelle fen√™tre
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Rapport de ${report.meetingType}</title>
                        <style>
                            body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
                            .report-header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2c3e50; padding-bottom: 20px; }
                            .report-title { color: #2c3e50; font-size: 1.8rem; margin-bottom: 10px; }
                            .report-meta { color: #666; font-style: italic; }
                            .report-section { margin-bottom: 25px; }
                            .agenda-point { margin-bottom: 15px; }
                            .agenda-point-title { font-weight: 600; margin-bottom: 8px; color: #2c3e50; }
                            .agenda-point-content { margin-left: 20px; color: #555; }
                            .signature-section { margin-top: 40px; text-align: right; }
                            .signature-line { width: 300px; border-bottom: 1px solid #333; margin: 40px auto 5px; display: inline-block; }
                            .signature-label { font-style: italic; color: #666; }
                            .discourse-flow { background-color: #e8f4fc; border-left: 4px solid #3498db; padding: 15px; margin: 20px 0; border-radius: 0 8px 8px 0; }
                            .transition-phrase { font-style: italic; color: #3498db; margin: 10px 0; font-weight: 500; }
                        </style>
                    </head>
                    <body>
                        ${reportHTML}
                    </body>
                    </html>
                `);
                printWindow.document.close();
            }
            
            // Charger un rapport sauvegard√© dans le formulaire
            function loadReport(reportId) {
                const report = savedReports.find(r => r.id === reportId);
                if (!report) return;
                
                // Remplir le formulaire avec les donn√©es du rapport
                document.getElementById('meetingType').value = report.meetingType;
                document.getElementById('meetingObject').value = report.meetingObject;
                document.getElementById('meetingDate').value = report.meetingDate.slice(0, 16);
                document.getElementById('meetingEndDate').value = report.meetingEndDate.slice(0, 16);
                document.getElementById('meetingLocation').value = report.meetingLocation;
                document.getElementById('secretaryName').value = report.secretaryName;
                
                // S√©lectionner le style de r√©daction
                document.querySelector(`input[name="writingStyle"][value="${report.writingStyle}"]`).checked = true;
                
                // Vider les points d'ordre du jour existants
                agendaItemsContainer.innerHTML = '';
                agendaItemCount = 0;
                
                // Ajouter les points d'ordre du jour
                report.agendaItems.forEach(item => {
                    agendaItemCount++;
                    const agendaItem = document.createElement('div');
                    agendaItem.className = 'agenda-item';
                    agendaItem.innerHTML = `
                        <div class="agenda-item-header">
                            <span class="agenda-item-title">Point ${agendaItemCount}</span>
                            <button type="button" class="remove-item">Supprimer</button>
                        </div>
                        <div class="form-group">
                            <label for="agendaTitle${agendaItemCount}">Titre du point</label>
                            <input type="text" id="agendaTitle${agendaItemCount}" value="${item.title}">
                        </div>
                        <div class="form-group">
                            <label for="agendaDetails${agendaItemCount}">Grandes lignes / D√©tails</label>
                            <textarea id="agendaDetails${agendaItemCount}">${item.details}</textarea>
                        </div>
                    `;
                    
                    agendaItemsContainer.appendChild(agendaItem);
                    
                    // Ajouter l'√©v√©nement de suppression
                    const removeBtn = agendaItem.querySelector('.remove-item');
                    removeBtn.addEventListener('click', function() {
                        agendaItemsContainer.removeChild(agendaItem);
                        updateAgendaItemNumbers();
                    });
                });
                
                // Stocker l'ID du rapport actuel
                currentReportId = reportId;
                
                // Faire d√©filer vers le formulaire
                document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
                
                alert('Rapport charg√© avec succ√®s ! Vous pouvez maintenant le modifier et le reg√©n√©rer.');
            }
            
            // Supprimer un rapport sauvegard√©
            function deleteReport(reportId) {
                if (confirm('√ätes-vous s√ªr de vouloir supprimer ce rapport ? Cette action est irr√©versible.')) {
                    savedReports = savedReports.filter(report => report.id !== reportId);
                    localStorage.setItem('savedReports', JSON.stringify(savedReports));
                    displaySavedReports();
                    
                    if (currentReportId === reportId) {
                        currentReportId = null;
                    }
                }
            }
            
            // √âv√©nements pour les filtres
            filterDate.addEventListener('change', displaySavedReports);
            filterType.addEventListener('change', displaySavedReports);
            filterKeyword.addEventListener('input', displaySavedReports);
            
            // R√©initialiser le formulaire
            resetFormBtn.addEventListener('click', function() {
                if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser le formulaire ? Toutes les donn√©es saisies seront perdues.')) {
                    document.getElementById('meetingType').value = 'Conseil';
                    document.getElementById('meetingObject').value = '';
                    document.getElementById('meetingDate').value = '';
                    document.getElementById('meetingEndDate').value = '';
                    document.getElementById('meetingLocation').value = '';
                    document.getElementById('secretaryName').value = '';
                    document.querySelector('input[name="writingStyle"][value="formal"]').checked = true;
                    agendaItemsContainer.innerHTML = '';
                    agendaItemCount = 0;
                    reportSection.classList.add('hidden');
                    currentReportId = null;
                    
                    // Ajouter un premier point √† l'ordre du jour
                    addAgendaItemBtn.click();
                }
            });
            
            // Imprimer le rapport
            printReportBtn.addEventListener('click', function() {
                window.print();
            });
            
            // Modifier les informations
            editReportBtn.addEventListener('click', function() {
                reportSection.classList.add('hidden');
                document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
            });
            
            // Ajouter un premier point √† l'ordre du jour au chargement
            addAgendaItemBtn.click();
        });
    </script>
</body>
</html>
